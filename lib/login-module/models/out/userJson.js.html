<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: userJson.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: userJson.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const bcrypt = require('bcryptjs');
const fs = require('fs');
const uuidV1 = require('uuid/v1');

var usersJson;
fs.readFile('db/users.json', 'utf8', function (err, data) {
  if (err) throw err;
  usersJson = JSON.parse(data);
});

/**
 * Creates User with encrypted and salted password
 * and unique id
 * 
 * @param {*} newUser - User to be created in json format
 */
module.exports.createUser = function(newUser){
    bcrypt.genSalt(10, function(err, salt) {
        bcrypt.hash(newUser.password, salt, function(err, hash) {
            newUser.password = hash;
            newUser.id = uuidV1();
            fs.readFile('db/users.json', function (err, data) {
                var json = JSON.parse(data);
                json.users.push(newUser);

                fs.writeFile("db/users.json", JSON.stringify(json))
            })
        });
    });
}
/**
 * Get user by username
 * 
 * @param {*} username - Username to be found
 * @param {*} callback 
 */
module.exports.getUserByUsername = function (username, callback) {
    for (index in usersJson.users) {
        if (usersJson.users[index].username==username){
           return callback(null, usersJson.users[index]);
        }
    }
    return callback(null,null);
}

/**
 * Compare if two provided passwords are equal
 * @param {*} userPassword - Password which we compare upon
 * @param {*} hash - Hash value of the password 
 * @param {*} callback 
 */
module.exports.comparePassword = function (userPassword, hash, callback){
  bcrypt.compare(userPassword, hash, function(err, isMatch) {
     if(err) throw err;
     callback(null, isMatch);
  });
}
/**
 * Find user from database by userId
 * @param {*} id  - Id by which a user is returned
 * @param {*} callback 
 */
module.exports.getUserById = function (id, callback) {
  for (index in usersJson.users) {
    if (usersJson.users[index].id==id){
        return callback(null, usersJson.users[index]);
    }
  }
  return callback(null,null);
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#comparePassword">comparePassword</a></li><li><a href="global.html#createUser">createUser</a></li><li><a href="global.html#getUserById">getUserById</a></li><li><a href="global.html#getUserByUsername">getUserByUsername</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Feb 27 2018 11:08:20 GMT+0100 (Central Europe Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
